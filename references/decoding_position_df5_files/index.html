<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html><head><meta content="text/html; charset=ISO-8859-1" http-equiv="content-type"><title>Decoding ADS-B position</title></head>
<body><div style="text-align: right;"><a style="color: rgb(102, 0, 0); font-weight: bold;" href="http://www.lll.lu/%7Eedward/edward/adsb/Very%20Simple%20ADSB%20receiver.html"><small>Back to the ADS-B receiver</small></a><br></div><big style="font-weight: bold;">How to decode the position of the aircraft&nbsp; from an Odd and an Even CPR ADS-B Frame?</big><br><br>Say you receive the following two frames:<br><br><span style="font-family: monospace;">8D75804B580FF2CF7E9BA6F701D0</span><br style="font-family: monospace;"><span style="font-family: monospace;">8D75804B580FF6B283EB7A157117</span><br><br>Bytes 2 to 4 give&nbsp;ICAO address <span style="font-family: monospace;">75804B</span> which is<br>CEB [5J] Cebu Pacific Air<br>Registration RP-C3191<br>Airbus A319<br><br>The first 5 bits contain the Downlink Format (DF).<br>First byte 8D is <span style="font-family: monospace;">10001-101</span> so DF=17 and CA=5<br>DF
17 means we have an extended 112 bit squitter. Not all extended
squitters have the position. We need to check the Type Code (TC).<br><br>Byte 5 is the first byte of the extended squitter as such, which is an extra 56 bits compared to a short squitter.<br>This makes up to the last 3 bytes not included. These last 3 bytes are an error check.<br>The Type Code is contained in the first 5 bits which is in Byte 5 of the whole frame: 58hex is <span style="font-family: monospace;">01011-000</span>bin<br>Both TC are <span style="font-family: monospace;">01011</span>bin which is&nbsp;11dec.<br>This TC is Airborne Position with Barometric Altitude as follows:<br>Airborne position with Horizontal protection limit: (HPL)&nbsp;25 m &#8804; HPL &lt; 185.2 m (0.1 NM)<br>95% Containment radius, &#956; and v, on horizontal and vertical position error: 10 m &#8804; &#956; &lt; 92.6 m (0.05 NM)<br>Navigational uncertainty category: 7<br><br>This is still not sufficient, as to start decoding positions we need an ODD and an EVEN frame.<br>These frames contain the position in CPR (Compact Position Reporting) format.<br>Whether a frame is odd or even is indicated in bit 22 of the extended squitter.<br>As we need more binary data lets change the extended squitters into binary.<br><br>The first frame:<br><span style="font-family: monospace;">580FF2CF7E9BA6</span><br style="font-family: monospace;"><span style="font-family: monospace;">[TC-]&nbsp; &nbsp; &nbsp;[-Altitude-] T F [----Latitude---] [---Longitutde--]</span><br style="font-family: monospace;"><span style="font-family: monospace;">01011 000 000011111111 0 0 10110011110111111 01001101110100110</span><br style="font-family: monospace;"><span style="font-family: monospace;"></span><br>The second frame:<br><span style="font-family: monospace;">580FF6B283EB7A</span><br style="font-family: monospace;"><span style="font-family: monospace;">[TC-] &nbsp; &nbsp; [-Altitude-] T F [----Latitude---] [---Longitutde--]</span><br style="font-family: monospace;"><span style="font-family: monospace;">01011 000 000011111111 0 1 10101100101000001 11110101101111010</span><br><span style="font-family: monospace;"></span><br>In the first byte:<br>First 5 bits are the TC which is 11.<br>A TC 11 decodes to the following fields:<br><br>Bits 6 and 7 are the Surveillance Status.<br>Bit 8 indicates the antennas used.<br>Bits 9 (MSB) to 20 (LSB) contain the altitude.<br>Bit 21 contains the T (Time) bit. T in this case is 0 which means we are not synchronized to UTC.<br>Bit 22 contains the F flag which indicates which CPR format is used (odd or even).<br>Bits 23 (MSB) to 39 (LSB) contain the encoded latitude.<br>Bits 40 (MSB) to 56 (LSB) contain the encoded longitude.<br><br>So our first frame has F flag = 0 so is even and the second frame has F flag = 1 so odd.<br>So we finaly know that we can use our information to find the position of this aircraft.<br><br><hr style="width: 100%; height: 2px;"><br>CPR uses several functions which are good to know before we start:<br><br><span style="font-style: italic;">Nb</span> is the number of bits for encoding. Airborne positions use <span style="font-style: italic;">Nb</span> = 17 as we can confirm from above. Note <span style="font-style: italic;">Nb</span> = 19 for surface positions.<br><br>CPR decodes positions to Zones <span style="font-style: italic;">Nz</span>. The number of possible zones for airborne positions is <span style="font-style: italic;">Nz</span> = 15 giving an unambiguous airborne range for decoding of&nbsp;360 NM.<br><br>The floor notation <span style="font-weight: bold;">floor</span>(x) denotes&nbsp;which is&nbsp;the greatest integer&nbsp;k such that k&lt;x. In VB6 this is done by the function <span style="font-weight: bold;">INT</span>.<br><br>Modulus&nbsp;<span style="font-weight: bold;">MOD</span>(x,y) is always positive. In VB6 I have written it as follows:<br><div style="margin-left: 40px;"><span style="font-family: monospace;">Function modulo(val, modval As Double) As Double</span><br style="font-family: monospace;"><span style="font-family: monospace;">&nbsp; modulo = val Mod modval</span><br style="font-family: monospace;"><span style="font-family: monospace;">&nbsp; If val &lt; 0 Then modulo = modulo + modval</span><br style="font-family: monospace;"><span style="font-family: monospace;">End Function</span><br style="font-family: monospace;"></div><br>The <span style="font-weight: bold;">NL</span>(x)
is a big one but only returns a number between 1 and 59. In my VB6
progam I use a lookup table as described in the PDF document <a href="http://adsb.tc.faa.gov/WG3_Meetings/Meeting9/1090-WP-9-14.pdf">1090-WP-9-14</a>.<cite></cite><br><br><hr style="width: 100%; height: 2px;"><br>So our starting point is:<br><br><span style="font-family: monospace;">Lat(0) = 10110011110111111 or 92095 dec</span><br style="font-family: monospace;"><span style="font-family: monospace;">Lat(1) = 10101100101000001 or 88385 dec</span><br style="font-family: monospace;"><span style="font-family: monospace;">Lon(0) = 01001101110100110 or 39846 dec</span><br style="font-family: monospace;"><span style="font-family: monospace;">Lon(1) = 11110101101111010 or 125818 dec</span><br style="font-family: monospace;"><br>1. Compute the latitude index <span style="font-style: italic;">j</span>:<br><div style="margin-left: 40px;">Under VB6 that is done as follows:<br><span style="font-family: monospace;">j = Int(((59 *&nbsp;Lat(0) - 60 *&nbsp;Lat(1)) / 131072) + 0.5)</span><br><div style="margin-left: 40px;">gives<br style="font-family: monospace;"></div><span style="font-family: monospace;">j = 1</span><br style="font-family: monospace;"></div><br>2. Compute the values of <span style="font-style: italic;">Rlat(0)</span> and <span style="font-style: italic;">Rlat(1)</span>:<br><div style="margin-left: 40px;"><span style="font-family: monospace;">rlat(0) = AirDlat0 * (modulo(j, 60) +&nbsp;Lat(0) / 131072)</span><br style="font-family: monospace;"><span style="font-family: monospace;">rlat(1) = AirDlat1 * (modulo(j, 59) +&nbsp;Lat(1) / 131072)</span><br style="font-family: monospace;"></div><div style="margin-left: 80px;">where<br style="font-family: monospace;"></div><div style="margin-left: 40px;"><span style="font-family: monospace;">Const AirDlat0 As Double = 6</span><br style="font-family: monospace;"><span style="font-family: monospace;">Const AirDlat1 As Double = 360 / 59</span><br style="font-family: monospace;"></div><div style="margin-left: 80px;">This gives<br style="font-family: monospace;"></div><div style="margin-left: 40px;"><span style="font-family: monospace;">rlat(0) =&nbsp; 10.2157745361328 </span><br style="font-family: monospace;"><span style="font-family: monospace;">rlat(1) =&nbsp; 10.2162144547802 </span><br>Note: Southern hemisphere values are 270° to 360°. Subtract 360°.<br></div><br>3.<span style="font-weight: bold;">NL</span> for&nbsp;<span style="font-style: italic;">Rlat(0)</span> and <span style="font-style: italic;">Rlat(1)</span> , <span style="font-weight: bold;">NL</span>(0) and <span style="font-weight: bold;">NL</span>(1) are both equal to 59. Do not proceed from here if <span style="font-weight: bold;">NL</span>(0) not equal to <span style="font-weight: bold;">NL</span>(1).<br><div style="margin-left: 40px;"><span style="font-family: monospace;">NL(0) =&nbsp; 59</span><br style="font-family: monospace;"><span style="font-family: monospace;">NL(1) =&nbsp; 59</span><br>Both NL are equal so rlat(0) and rlat(1) are our latitudes.<br></div><br>4. <span style="font-style: italic;">i</span> being the frame to decode, the last frame is odd, <span style="font-style: italic;">i</span> = 1, compute <span style="font-style: italic;">n(i)</span> which is the greater of 1 and <span style="font-weight: bold;">NL</span>(<span style="font-style: italic;">i</span>) - <span style="font-style: italic;">i</span><br><div style="margin-left: 40px;"><span style="font-family: monospace;">ni = 58</span><br></div><br>5. Next <span style="font-style: italic;">Dlon(i)</span> = 360 / <span style="font-style: italic;">n(i)</span><br><div style="margin-left: 40px; font-family: monospace;">dlon(1) =&nbsp; 6.20689655172414 <br></div><br>6.Find M, the longitude index. You need to know that in this case T = 1 (odd).<br><div style="margin-left: 40px;"><span style="font-family: monospace;">M = Int((((Lon(0) * (nl(T) - 1)) - (Lon(1) * nl(T))) / 131072) + 0.5)</span><br><div style="margin-left: 40px;">gives<br></div><span style="font-family: monospace;">M = -39</span><br></div><br>7. Compute the global longitude, Lon<br><div style="margin-left: 40px;"><span style="font-family: monospace;">Lon = dlon(T) * (modulo(M, ni) +&nbsp;Lon(T) / 131072)</span><br><div style="margin-left: 40px;">gives<br></div><span style="font-family: monospace;">Lon =&nbsp; 123.889128586342</span><br></div><br>So there you have it!<br><br>On the second frame our aircraft was at<br><br><div style="margin-left: 40px; font-family: monospace;">Lon =&nbsp; 123.889128586342 <br>Lat =&nbsp; 10.2162144547802 <br></div><br><br>Also on 2nd frame for example: Altitude is 2175 feet but that is a different story ...<br><br></body></html>